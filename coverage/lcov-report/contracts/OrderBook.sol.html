<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/OrderBook.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> OrderBook.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">85.71% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>66/77</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">52.27% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>23/44</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">81.25% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>13/16</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">82.95% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>73/88</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity ^0.4.18;
&nbsp;
import "./RepublicToken.sol";
import "./MinerRegistrar.sol";
import "./TraderRegistrar.sol";
&nbsp;
/** Active WIP */
contract OrderBook {
&nbsp;
  /** Contracts */
&nbsp;
  RepublicToken ren;
  MinerRegistrar minerRegistrar;
  TraderRegistrar traderRegistrar;
&nbsp;
  /** Data */
&nbsp;
  struct MatchFragment {
    bytes20 minerID;
&nbsp;
    bytes32 orderFragmentID1;
    bytes32 orderFragmentID2;
    bytes outputFragment;
  }
&nbsp;
  struct Match {
    bytes32 orderID1;
    bytes32 orderID2;
&nbsp;
    MatchFragment[] matchFragments;
  }
&nbsp;
	struct Order {
    bytes32 orderID;
    bytes20 traderID;
&nbsp;
		Status status;
    uint256 fee;
    uint256 timestamp;
&nbsp;
    uint256 orderFragmentCount;
    mapping (bytes20 =&gt; bytes32) minersToOrderFragmentIDs;
	}
&nbsp;
  // Matched order (orderID =&gt; matchID)
  // This could instead be a match from an order to another order
  mapping(bytes32 =&gt; bytes32) orderMatch;
&nbsp;
  // Mapping from matchIDs to their matches
  mapping(bytes32 =&gt; Match) matches;
&nbsp;
  // TODO: Use enum instead
  enum Status { Open, Expired, Closed }
&nbsp;
	uint8 public orderLimit = 100;
	uint32 public minimumOrderFee = 100000;
  
	mapping (bytes32 =&gt; Order) public orders;
	mapping (bytes32 =&gt; bytes20) owners; // orderID to owner
  mapping (bytes32 =&gt; address) refundAddress;
  mapping (bytes20 =&gt; uint) orderCount;
  mapping (bytes32 =&gt; uint) rewards;
&nbsp;
  /** Events */
&nbsp;
  event OrderPlaced(bytes32 _hash, bytes20 _trader);
  event OrderExpired(bytes32 _hash);
	event OrderClosed(bytes32 _hash);
  event Debug(string msg);
  event DebugAddress(address msg);
  event Debug32(bytes32 msg);
  event DebugBool(bool msg);
  event DebugInt(uint256 msg);
&nbsp;
  /** Modifiers */
&nbsp;
  /**
   * @notice Only allow for orders that are currently open
   *
   * @param _orderID The ID of the order that must be open
   */
  modifier onlyOpenOrder(bytes32 _orderID) {
    <span class="missing-if-branch" title="else path not taken" >E</span>require(orders[_orderID].status == Status.Open);
    _;
  }
&nbsp;
  /**
   * @notice Only allow for orders that are currently closed
   *
   * @param _orderID The ID of the order that must be closed
   */
  modifier onlyClosedOrder(bytes32 _orderID) {
    <span class="missing-if-branch" title="else path not taken" >E</span>require(orders[_orderID].status == Status.Closed);
    _;
  }
&nbsp;
  /** Private functions */
&nbsp;
  /**
   * Calculate the K value (number of fragments needed to be combined)
   * Should this be passed in or calculated deterministically?
   *
   * @param _orderFragmentCount The total number of fragments created
   */
  function getKValue(uint256 _orderFragmentCount) private pure returns (uint256) {
    // orderFragmentCount should be odd
    // assert(orderFragmentCount % 2 == 1);
    return (_orderFragmentCount - 1) / 2 + 1;
  }
&nbsp;
&nbsp;
  /**
   * @notice Verify that an array of miners is registered by calling upon the
   * MinerRegistrar contract.
   *
   * @param _minerIDs The array of miner IDs that will be verified.
   *
   * @return True if all miners are registered, false otherwise.
   */
  function verifyMiners(bytes20[] _minerIDs) private returns (bool) {
    bool status = true;
    for (uint i = 0; i &lt; _minerIDs.length &amp;&amp; status; i++) {
      status = status &amp;&amp; minerRegistrar.isRegistered(_minerIDs[i]); 
    }
    return status;
  }
&nbsp;
  /**
   * @notice Deterministically calculate the ID of a match based on the IDs of its two orders
   */
  function getMatchID(bytes32 _orderID1, bytes32 _orderID2) private returns (bytes32) {
    // TODO: How does solidity compare bytes?
    if (_orderID1 &lt; _orderID2) {
      return keccak256(_orderID1, _orderID2);
    } else {
      return keccak256(_orderID2, _orderID1);
    }
  }
&nbsp;
  /** Public functions */
&nbsp;
  /**
   * @notice The OrderBook constructor.
   *
	 * @param _republicToken The address of the REN token contract.
   * @param _minerRegistrar The address of the miner registrar contract.
   * @param _traderRegistrar The address of the trader registrar contract.
   */
  function OrderBook(address _republicToken, address _minerRegistrar, address _traderRegistrar) public {
    ren = RepublicToken(_republicToken);
    minerRegistrar = MinerRegistrar(_minerRegistrar);
    traderRegistrar = TraderRegistrar(_traderRegistrar);
  }
&nbsp;
  /**
  * @notice Traders call this function to open an order.
  *
  * @param _traderID The trader's ID
	* @param _orderID The hash of the order.
  * @param _orderFragmentIDs The list of hashes of the fragments.
  * @param _miners The list of miners that are authorized to close the order.
  * @param _minerLeaders ...
  */
	function openOrder(bytes20 _traderID, bytes32 _orderID, bytes32[] _orderFragmentIDs, bytes20[] _miners, bytes20[] _minerLeaders) public {
    
    uint256 orderFragmentCount = minerRegistrar.getMNetworkSize();
&nbsp;
    // Miner count should be within one of orderFragmentCount
    <span class="missing-if-branch" title="else path not taken" >E</span>require(_miners.length == _orderFragmentIDs.length ||
            _miners.length == _orderFragmentIDs.length - 1);
&nbsp;
    // Leader count should be exactly the orderFragmentCount
    <span class="missing-if-branch" title="else path not taken" >E</span>require(_minerLeaders.length == _orderFragmentIDs.length);
&nbsp;
    <span class="missing-if-branch" title="else path not taken" >E</span>require(_orderFragmentIDs.length == orderFragmentCount);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(verifyMiners(_miners));
    <span class="missing-if-branch" title="else path not taken" >E</span>require(verifyMiners(_minerLeaders));
    <span class="missing-if-branch" title="else path not taken" >E</span>require(orderCount[_traderID] &lt; orderLimit);
    
    uint256 fee = ren.allowance(msg.sender, address(this));
    <span class="missing-if-branch" title="else path not taken" >E</span>require(fee &gt;= minimumOrderFee);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(ren.transferFrom(msg.sender, address(this), fee));
    
    orders[_orderID] = Order({
      orderID: _orderID,
      traderID: _traderID,
      
      status: Status.Open,
      fee: fee,
      timestamp: now,
&nbsp;
      orderFragmentCount: orderFragmentCount
    });
&nbsp;
    // Approve each miner for their respective order fragment
    for (uint256 i = 0; i &lt; _miners.length; i++ ) {
      orders[_orderID].minersToOrderFragmentIDs[_miners[i]] = _orderFragmentIDs[i];
    }
    for (uint256 j = 0; j &lt; _minerLeaders.length; j++ ) {
      orders[_orderID].minersToOrderFragmentIDs[_minerLeaders[j]] = _orderFragmentIDs[j];
    }
&nbsp;
    orderCount[_traderID]++;
    owners[_orderID] = _traderID;
    refundAddress[_orderID] = msg.sender;
&nbsp;
		OrderPlaced(_orderID, _traderID);
	}
&nbsp;
	/**
   * @notice Traders call this function to expire an order and refund the order
   * fee.
   *
   * @param _orderID The order ID of the order that will be expired.
   */
<span class="fstat-no" title="function not covered" >	function expireOrder(bytes32 _orderID) public {</span>
<span class="cstat-no" title="statement not covered" >		require(now - orders[_orderID].timestamp &gt; 2 days)</span>;
<span class="cstat-no" title="statement not covered" >    orders[_orderID].status = Status.Expired</span>;
    orderCount[owners[_orderID]]--;
    // TODO: Get address from republic ID
    ren.transfer(refundAddress[_orderID], orders[_orderID].fee);
    delete owners[_orderID];
<span class="cstat-no" title="statement not covered" >		OrderExpired(_orderID)</span>;
	}
&nbsp;
	/**
   * @notice Miners call this function to close an order. The order is not
   * closed until 50% (or more) of the required miners have called this
   * function for the same orders. When the order is successfully closed, the
   * order fees will be evenly distributed to miners as a reward.
   *
	 * @param _orderID1 The order ID of the first order.
	 * @param _orderID2 The order ID of the second order.
   */
	function closeOrders(bytes32 _orderID1, bytes32 _orderID2) onlyOpenOrder(_orderID1) onlyOpenOrder(_orderID2) internal {
    bytes32 matchID = getMatchID(_orderID1,_orderID2);
    matches[matchID].orderID1 = _orderID1;
    matches[matchID].orderID2 = _orderID2;
&nbsp;
    uint256 kValue = getKValue(orders[_orderID1].orderFragmentCount);
&nbsp;
    // require();
    uint fee = (orders[_orderID1].fee + orders[_orderID2].fee) / kValue;
    orders[_orderID1].status = Status.Closed;
    orders[_orderID2].status = Status.Closed;
&nbsp;
    orderMatch[_orderID1] = matchID;
    orderMatch[_orderID2] = matchID;
&nbsp;
    // Decrease order counts of each trader
    orderCount[owners[_orderID1]]--;
    orderCount[owners[_orderID2]]--;
&nbsp;
    // reward miners
    for (uint256 i = 0; i &lt; kValue; i++) {
      bytes20 minerID = matches[matchID].matchFragments[i].minerID;
      rewards[minerID] += fee;
    }
    // TODO: Do something with remainder
    // uint256 sum = (fee / kValue) * kValue;
    delete owners[_orderID1];
    delete owners[_orderID2];
		OrderClosed(_orderID1);
    OrderClosed(_orderID2);
	}
&nbsp;
  /**
   * @notice Check that an order fragment has been assigned to an open order
   * and that the given miner is authorized to close it.
   *
   * @param _orderID The order ID that is associated with the order fragment.
   * @param _orderFragmentID The order fragment ID that is being checked.
   * @param _minerID The miner ID that is being checked for authorization.
   *
   * @return True if the miner is authorized to close the order fragment and
   * order is open, false otherwise.
   */
  function checkOrderFragment(bytes32 _orderID, bytes32 _orderFragmentID, bytes20 _minerID) public returns (bool) {
    return (orders[_orderID].status == Status.Open &amp;&amp; orders[_orderID].minersToOrderFragmentIDs[_minerID] == _orderFragmentID);
  }
&nbsp;
  /**
   * @notice Submit an output fragment for a match. Once enough have been submitted,
   * the order is closed.
   *
   * @param _outputFragment ...
   * @param _orderID1 ...
   * @param _orderID2 ...
   * @param _minerID ...
   * @param _orderFragmentID1 ...
   * @param _orderFragmentID2 ...
   */
  function submitOutputFragment(
      bytes _outputFragment,
      bytes32 _orderID1,
      bytes32 _orderID2,
      bytes20 _minerID,
      bytes32 _orderFragmentID1,
      bytes32 _orderFragmentID2) public onlyOpenOrder(_orderID1) onlyOpenOrder(_orderID2)
  {
&nbsp;
    // Check that the miner has submitted the right fragment IDs
    <span class="missing-if-branch" title="else path not taken" >E</span>require(orders[_orderID1].minersToOrderFragmentIDs[_minerID] == _orderFragmentID1);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(_orderFragmentID1 != 0x0);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(orders[_orderID2].minersToOrderFragmentIDs[_minerID] == _orderFragmentID2);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(_orderFragmentID2 != 0x0);
&nbsp;
    // TODO: Check that the orders have the same orderFragmentCount?
        
    // Check that msg.sender is the miner
    <span class="missing-if-branch" title="else path not taken" >E</span>require(msg.sender == minerRegistrar.getEthereumAddress(_minerID));
&nbsp;
    bytes32 matchID = getMatchID(_orderID2,_orderID1);
&nbsp;
    // New matchFragment
    matches[matchID].matchFragments.push(MatchFragment({
      outputFragment: _outputFragment,
      minerID: _minerID,
      orderFragmentID1: _orderFragmentID1,
      orderFragmentID2: _orderFragmentID2
    }));
&nbsp;
    uint256 kValue = getKValue(orders[_orderID1].orderFragmentCount);
    uint256 length = matches[matchID].matchFragments.length;
    if (length == kValue) {
      closeOrders(_orderID1, _orderID2);
    }
  }
&nbsp;
  /**
   * @notice Allow a miner to withdraw their reward to the Ethereum address used
   * to register them
   *
   * @param _minerID The ID of the miner
   */
  function withdrawReward(bytes20 _minerID) public {
    address owner = minerRegistrar.getOwner(_minerID);
&nbsp;
    // Should anyone be able to call this?
    <span class="missing-if-branch" title="if path not taken" >I</span>require(owner == msg.sender);
&nbsp;
<span class="cstat-no" title="statement not covered" >    uint256 reward = rewards[_minerID]</span>;
<span class="cstat-no" title="statement not covered" >    rewards[_minerID] = 0</span>;
    ren.transfer(owner, reward);
  }
&nbsp;
  /**
   * @notice Get the reward amount a miner can withdraw
   *
   * @param _minerID The ID of the miner
   * @return The reward in Ren?
   */
  function getReward(bytes20 _minerID) public view returns (uint256) {
    return rewards[_minerID];
  }
&nbsp;
  /**
   * @notice Get the status of an order
   *
   * @param _orderID The ID of the order
   * @return The status as a number?, corresponding to the enum { Open, Expired, Closed }
   */
<span class="fstat-no" title="function not covered" >  function getOrderStatus(bytes32 _orderID) public view returns (Status) </span>{
<span class="cstat-no" title="statement not covered" >    return orders[_orderID].status;</span>
  }
&nbsp;
  /**
   * @notice Get the status of a match
   *
   * @param _matchID The ID of the match
   * @return The status as a number?, corresponding to the enum { Open, Expired, Closed }
   */
<span class="fstat-no" title="function not covered" >  function getMatchStatus(bytes32 _matchID) public view returns (Status) </span>{
<span class="cstat-no" title="statement not covered" >    Status status1 = orders[matches[_matchID].orderID1].status</span>;
<span class="cstat-no" title="statement not covered" >    Status status2 = orders[matches[_matchID].orderID2].status</span>;
<span class="cstat-no" title="statement not covered" >    require(status1 == status2)</span>;
<span class="cstat-no" title="statement not covered" >    return status1;</span>
  }
&nbsp;
  /**
   * @notice Get the corresponding matched order
   *
   * @param _orderID The ID of the order to find of the match of
   * @return matchedOrderID The ID of the matched order
   * @return matchedTraderID the ID of the matched order's trader
   */
  function getMatchedOrder(bytes32 _orderID) onlyClosedOrder(_orderID) public view returns (bytes32 matchedOrderID, bytes20 matchedTraderID) {
    bytes32 matchID = orderMatch[_orderID];
    if (_orderID == matches[matchID].orderID1) {
      matchedOrderID = matches[matchID].orderID2;
    } else <span class="missing-if-branch" title="else path not taken" >E</span>if (_orderID == matches[matchID].orderID2) {
      matchedOrderID = matches[matchID].orderID1;
    } else {
<span class="cstat-no" title="statement not covered" >      revert()</span>;
    }
&nbsp;
    matchedTraderID = orders[matchedOrderID].traderID;
&nbsp;
    // Not necessary
    return (matchedOrderID, matchedTraderID);
  }
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Jan 12 2018 21:45:54 GMT+1100 (AEDT)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
