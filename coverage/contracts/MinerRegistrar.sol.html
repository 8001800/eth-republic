<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/MinerRegistrar.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> MinerRegistrar.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.61% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>109/114</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">70.83% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>34/48</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">86.21% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>25/29</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.69% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>111/116</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">279×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">504×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">381×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">56×</span>
<span class="cline-any cline-yes">56×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">56×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">73×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">73×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">60×</span>
<span class="cline-any cline-yes">60×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">115×</span>
<span class="cline-any cline-yes">115×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">155×</span>
<span class="cline-any cline-yes">155×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">166×</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-yes">46×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">129×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">56×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">46×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">46×</span>
<span class="cline-any cline-yes">46×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">43×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">33×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity ^0.4.17;
&nbsp;
import './Utils.sol';
import "./RepublicToken.sol";
&nbsp;
/**
 * Active WIP
 * TODOS:
 * 1. Break up into smaller contracts, e.g.:
 *    a. Epoch contract
 *    b. Miner list?
 *    c. Miner properties shared with traders? (e.g. public key storage)
 * 2. Remove Debug events
 */
contract MinerRegistrar {
&nbsp;
  /** Contracts */
&nbsp;
  // TODO: Use SafeMath library?
  RepublicToken ren;
&nbsp;
  /** Data */
&nbsp;
  struct Miner {
    bytes publicKey;
    address owner;
    uint256 bond;
    bytes32 seed;
    uint256 index;
&nbsp;
    uint256 bondPendingWithdrawal;
    uint256 bondWithdrawalTime;
  }
&nbsp;
  struct Epoch {
    uint256 time;
    bytes32 blockhash;
  }
&nbsp;
  Epoch currentEpoch;
&nbsp;
  // CONFIGURATION
  uint256 epochInterval;
  uint256 minimumBond;
&nbsp;
  // Map from Republic IDs to miner structs
  mapping(bytes20 =&gt; Miner) private miners;
&nbsp;
  // Map from ethereum public addresses to miner IDs
  mapping(address =&gt; bytes20) private addressIDs;
&nbsp;
  // Layout:
  // [0, deregistered..., toDeregister..., registered..., toRegister...]
  // Since an index of 0 could be either uninitialized or 0, the first element is reserved
  bytes20[] minerList;
&nbsp;
  uint256 deregisteredCount;
  uint256 toDeregisterCount;
  uint256 toRegisterCount;
  uint256 stayingRegisteredCount;
&nbsp;
  /** Events */
&nbsp;
  event MinerRegistered(bytes20 minerID, uint256 bond);
  event MinerBondUpdated(bytes20 minerID, uint256 newBond);
  event MinerDeregistered(bytes20 minerID);
  event BondRefunded(bytes20 minerID, uint256 amount);
  event Debug(string message);
  event DebugInt(uint256 num);
  event NextEpoch();
  
  /** Private functions */
&nbsp;
  function toRegisterOffset() view private returns (uint256) {
    return stayingRegisteredOffset() + stayingRegisteredCount;
  }
&nbsp;
  function toDeregisterOffset() view private returns (uint256) {
    return deregisteredCount + 1;
  }
&nbsp;
  function stayingRegisteredOffset() view private returns (uint256) {
    return toDeregisterOffset() + toDeregisterCount;
  }
&nbsp;
  function isStayingRegistered(bytes20 _minerID) private view returns (bool) {
    uint256 index = miners[_minerID].index;
    return index &gt;= stayingRegisteredOffset() &amp;&amp; index &lt; toRegisterOffset();
  }
&nbsp;
  function canRegister(bytes20 _minerID) private view returns (bool) {
    // TODO: Can register if in toDeregister
    return !isRegistered(_minerID) &amp;&amp; !isPendingRegistration(_minerID);
  }
&nbsp;
  function canDeregister(bytes20 _minerID) private view returns (bool) {
    return isStayingRegistered(_minerID) || isPendingRegistration(_minerID);
  }
&nbsp;
  /**
   * @notice A private function that updates a miner's bond that is pending
   * withdrawal.
   *
   * @param _minerID The ID of the miner that is being updated.
   * @param _amount The bond update amount.
   */
  function updateBondWithdrawal(bytes20 _minerID, uint256 _amount) private {
&nbsp;
    miners[_minerID].bond -= _amount;
&nbsp;
    if (miners[_minerID].bondPendingWithdrawal &gt; 0 &amp;&amp; miners[_minerID].bondWithdrawalTime &lt; currentEpoch.time) {
      // Can withdraw previous bond
      uint256 toWithdraw = miners[_minerID].bondPendingWithdrawal;
&nbsp;
      // Store new amount and time
      miners[_minerID].bondPendingWithdrawal = _amount;
      miners[_minerID].bondWithdrawalTime = now;
&nbsp;
      // Transfer Ren (ERC20 token)
      // TODO: Should this be moved to withdrawBond?
      bool success = ren.transfer(msg.sender, toWithdraw);
      <span class="missing-if-branch" title="else path not taken" >E</span>require(success);
&nbsp;
      BondRefunded(_minerID, toWithdraw);
    } else {
      // Can't withdraw any bond
      miners[_minerID].bondPendingWithdrawal += _amount;
      miners[_minerID].bondWithdrawalTime = now;
    }
  }
&nbsp;
  /** Public functions */
&nbsp;
  /** 
   * @notice The MinerRegistrar constructor.
   *
   * @param _renAddress The address of the Republic Token contract.
   * @param _epochInterval The amount of time between epochs, in seconds.
   * @param _minimumBond The minimum bond amount that can be submitted by a
   *                     trader.
   */
  function MinerRegistrar(address _renAddress, uint256 _epochInterval, uint256 _minimumBond) public {
    ren = RepublicToken(_renAddress);
    epochInterval = _epochInterval;
    minimumBond = _minimumBond;
    minerList.push(0x0);
    checkEpoch();
  }
&nbsp;
  function isRegistered(bytes20 _minerID) public view returns (bool) {
    uint256 index = miners[_minerID].index;
    return index &gt;= toDeregisterOffset() &amp;&amp; index &lt; toRegisterOffset();
  }
&nbsp;
  function isPendingRegistration(bytes20 _minerID) public view returns (bool) {
    uint256 index = miners[_minerID].index;
    return index &gt;= toRegisterOffset() &amp;&amp; index &lt; (toRegisterOffset() + toRegisterCount);
  }
  
  /**
   * @notice Check if the epoch needs to be updated, and update it if
   * necessary.
   *
   * @return True if the epoch was updated, otherwise false.
   */
  function checkEpoch() public returns (bool) {
    // NOTE: Requires `epochInterval` &lt; `now`
    if (now &gt; currentEpoch.time + epochInterval) {
      currentEpoch = Epoch({
        time: now,
        blockhash: block.blockhash(block.number - 1)
      });
&nbsp;
      // TODO: Would zeroing deregistered miners return gas?
      for (uint256 i = deregisteredCount; i &lt; deregisteredCount + toDeregisterCount; i++) {
        delete minerList[i];
      }
&nbsp;
      // Update counts
      deregisteredCount += toDeregisterCount;
      stayingRegisteredCount += toRegisterCount;
      toRegisterCount = 0;
      toDeregisterCount = 0;
&nbsp;
      NextEpoch();
&nbsp;
      return true;
    }
  
    return false;
  }
&nbsp;
  /** 
   * @notice Register a miner and transfer the bond to this contract. The
   * caller must provide the public key of the miner that will be registered
   * and a signature that proves the caller has access to the associated
   * private key. The bond must be provided in REN, as an allowance. The entire
   * allowance is transferred and used as the bond.
   *
   * @param _publicKey The public key of the miner. It is stored to allow other
   *                   miners and traders to encrypt messages to the miner.
   * @param _signature The Republic ID, generated from the public key and signed
   *                   by the associated private key. It is used as a proof that
   *                   the miner owns the submitted public key.
   */
  function register(bytes _publicKey, bytes _signature) payable public {
&nbsp;
    // an outside entity will be calling this after each epochInterval has passed
    // if that has not happened yet, the next miner to register will trigger the update instead
    // checkEpoch(); // &lt;1k gas if no update needed, &gt;40k gas if update needed
&nbsp;
    address minerAddress = Utils.ethereumAddressFromPublicKey(_publicKey);
    bytes20 minerID = Utils.republicIDFromPublicKey(_publicKey);
&nbsp;
    // TODO: Check a signature instead
    // Verify that the miner has provided the correct public key
    <span class="missing-if-branch" title="else path not taken" >E</span>require(msg.sender == minerAddress);
&nbsp;
    // Miner should not be already registered or awaiting registration
    require(canRegister(minerID));
&nbsp;
    // Set bond to be allowance plus any remaining bond from previous registration
    uint256 allowance = ren.allowance(msg.sender, this);
    // TODO: Use safe maths
    uint256 bond = allowance + miners[minerID].bondPendingWithdrawal;
&nbsp;
    // Bond should be greater than minumum
    <span class="missing-if-branch" title="else path not taken" >E</span>require (bond &gt; minimumBond);
&nbsp;
    // Transfer Ren (ERC20 token)
    bool success = ren.transferFrom(msg.sender, this, allowance);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(success);
&nbsp;
    // Store public key and bond
    uint256 index = minerList.push(minerID) - 1;
&nbsp;
    toRegisterCount += 1;
&nbsp;
    bytes32 seed = keccak256(now, block.blockhash(block.number - 1), minerID);
&nbsp;
    var miner = Miner({
      publicKey: _publicKey,
      owner: msg.sender,
      bond: bond,
      seed: seed,
      index: index,
      bondPendingWithdrawal: 0,
      bondWithdrawalTime: 0
    });
&nbsp;
    miners[minerID] = miner;
&nbsp;
    addressIDs[minerAddress] = minerID;
&nbsp;
    // Emit event to logs
    MinerRegistered(minerID, bond);
  }
&nbsp;
  /**
   * @notice Increase bond or decrease a miners's bond
   *
   * @param _minerID The Republic ID of the miner
   * @param _newBond The new bond to be set for the miner, greater than or less than the current bond
   */
  function updateBond(bytes20 _minerID, uint256 _newBond) payable public {
    // Ensure miner is already registered
    <span class="missing-if-branch" title="else path not taken" >E</span>require(isPendingRegistration(_minerID) || isStayingRegistered(_minerID));
    
    // Only allow owner to modify bond
    address owner = Utils.ethereumAddressFromPublicKey(miners[_minerID].publicKey);
    <span class="missing-if-branch" title="else path not taken" >E</span>require(owner == msg.sender);
&nbsp;
    // Set new bond
    <span class="missing-if-branch" title="else path not taken" >E</span>require(_newBond &gt; 0);
    uint256 oldBond = miners[_minerID].bond;
    <span class="missing-if-branch" title="if path not taken" >I</span>if (_newBond == oldBond) {
<span class="cstat-no" title="statement not covered" >      return;</span>
    }
&nbsp;
    if (_newBond &gt; oldBond) {
      // Increasing bond
&nbsp;
      uint256 toAdd = _newBond - oldBond;
&nbsp;
      // Sanity checks
      <span class="missing-if-branch" title="else path not taken" >E</span>assert(toAdd &lt; _newBond);
      <span class="missing-if-branch" title="else path not taken" >E</span>assert(toAdd &gt; 0);
&nbsp;
      // Transfer Ren (ERC20 token)
      require(ren.allowance(msg.sender, this) &gt;= toAdd);
      bool success = ren.transferFrom(msg.sender, this, toAdd);
      <span class="missing-if-branch" title="else path not taken" >E</span>require(success);
&nbsp;
      miners[_minerID].bond = _newBond;
&nbsp;
&nbsp;
    } else <span class="missing-if-branch" title="else path not taken" >E</span>if (_newBond &lt; oldBond) {
      // Decreasing bond
&nbsp;
      uint256 toRefund = oldBond - _newBond;
&nbsp;
      // Sanity check
      <span class="missing-if-branch" title="else path not taken" >E</span>assert(toRefund &lt; oldBond);
&nbsp;
      updateBondWithdrawal(_minerID, toRefund);
    }
&nbsp;
    // Emit event to logs
    MinerBondUpdated(_minerID, _newBond);
  }
&nbsp;
  /** 
  * @notice Deregister a miner and refund their bond.
  *
  * @param _minerID The Republic ID of the miner.
  */
  function deregister(bytes20 _minerID) public {
&nbsp;
    // Check that they can deregister
    require(canDeregister(_minerID));
&nbsp;
    // Check that the msg.sender owns the miner
    <span class="missing-if-branch" title="else path not taken" >E</span>require(miners[_minerID].owner == msg.sender);
&nbsp;
    // Swap miners around
    uint256 destinationIndex;
    uint256 currentIndex = miners[_minerID].index;
&nbsp;
    bool decreaseLength = false;
&nbsp;
    // TODO: If miner is in toRegister, put at end of toRegister and delete, instead
    if (isPendingRegistration(_minerID)) {
      // still in toRegister
&nbsp;
      // last in toRegister
      destinationIndex = toRegisterOffset() + toRegisterCount - 1;
&nbsp;
      // Update count
      toRegisterCount -= 1;
&nbsp;
      decreaseLength = true;
&nbsp;
    } else {
&nbsp;
      // already registered, so swap into toDeregister
&nbsp;
      // first in registered
      destinationIndex = stayingRegisteredOffset();
&nbsp;
      // Update count
      stayingRegisteredCount -= 1;
      toDeregisterCount += 1;
    }
&nbsp;
    // Swap two miners in minerList
    minerList[currentIndex] = minerList[destinationIndex];
    minerList[destinationIndex] = _minerID;
    // Update their indexes
    miners[minerList[currentIndex]].index = currentIndex;
    miners[minerList[destinationIndex]].index = destinationIndex;
&nbsp;
    if (decreaseLength) {
      delete minerList[destinationIndex]; // Never registered, so safe to delete
      minerList.length = minerList.length - 1;
    }
&nbsp;
    updateBondWithdrawal(_minerID, miners[_minerID].bond);
&nbsp;
    // Emit event to logs
    MinerDeregistered(_minerID);
  }
&nbsp;
  /**
  * @notice Withdraw the bond of a miner. This is the latter of two functions a
  * miner must call to retrieve their bond. The first call is to decrease their
  * bond or deregister. This stages an amount of bond to be withdrawn. This 
  * function then allows them to actually make the withdrawal.
  *
  * @param _minerID The Republic ID of the miner.
  */
  function withdrawBond(bytes20 _minerID) public {
    updateBondWithdrawal(_minerID, 0);
  }
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;
  /*** General getters ***/
&nbsp;
  function getEpochBlockhash() public view returns (bytes32) {
    return currentEpoch.blockhash;
  }
&nbsp;
  // TODO: Allow requesting miners from index i to j (to get miners in batches)
  function getCurrentMiners(uint256 _start, uint256 _end) public view returns (bytes20[]) {
&nbsp;
    uint256 currentMinerCount = toDeregisterCount + stayingRegisteredCount;
&nbsp;
    require(_start &lt; _end &amp;&amp; _end &lt;= currentMinerCount);
&nbsp;
    uint256 registered_start = toDeregisterOffset();
&nbsp;
    bytes20[] memory currentMiners = new bytes20[](_end - _start);
&nbsp;
    for (uint256 i = 0; i &lt; _end - _start; i++) {
      currentMiners[i] = minerList[i + registered_start + _start];
    }
    return currentMiners;
  }
&nbsp;
  // TODO: Used for debugging only?, remove before mainnet
<span class="fstat-no" title="function not covered" >  function getAllMiners() public view returns (bytes20[]) </span>{
    // Note: Returns 0x0 at starting position
<span class="cstat-no" title="statement not covered" >    return minerList;</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function getMNetworkCount() public view returns (uint256) </span>{
    // TODO: Should be rounded up?
<span class="cstat-no" title="statement not covered" >    return (toDeregisterCount + stayingRegisteredCount) / getMNetworkSize();</span>
  }
  
  function getMNetworkSize() public view returns (uint256) {
    uint256 log = Utils.logtwo(toDeregisterCount + stayingRegisteredCount);
    
    // If even, add 1 to become odd
    return log + (1 - (log % 2));
  }
&nbsp;
  function getCurrentMinerCount() public view returns (uint256) {
    return (toDeregisterCount + stayingRegisteredCount);
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function getNextMinerCount() public view returns (uint256) </span>{
<span class="cstat-no" title="statement not covered" >    return stayingRegisteredCount + toRegisterCount;</span>
  }
&nbsp;
  function getBond(bytes20 _minerID) public view returns (uint256) {
    // Check if they have bond pending to be withdrawn but still valid
    if (miners[_minerID].bondWithdrawalTime &gt;= currentEpoch.time) {
      return miners[_minerID].bond + miners[_minerID].bondPendingWithdrawal;
    } else {
      return miners[_minerID].bond;
    }
  }
&nbsp;
  function getOwner(bytes20 _minerID) public view returns (address) {
    return miners[_minerID].owner;
  }
&nbsp;
  function getSeed(bytes20 _minerID) public view returns (bytes32) {
    return miners[_minerID].seed;
  }
  
  // Allow anyone to see a Republic ID's public key
  function getPublicKey(bytes20 _minerID) public view returns (bytes) {
    return miners[_minerID].publicKey;
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function getMinerID(address _addr) public view returns (bytes20) </span>{
<span class="cstat-no" title="statement not covered" >    return addressIDs[_addr];</span>
  }
&nbsp;
  function getEthereumAddress(bytes20 _minerID) public view returns (address) {
    return Utils.ethereumAddressFromPublicKey(miners[_minerID].publicKey);
  }
&nbsp;
  function getBondPendingWithdrawal(bytes20 _minerID) public view returns (uint256) {
    return miners[_minerID].bondPendingWithdrawal;
  }
&nbsp;
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Jan 12 2018 21:45:54 GMT+1100 (AEDT)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
